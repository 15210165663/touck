
<!-- saved from url=(0047)http://t.10jqka.com.cn/static/loginplugin.shtml -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head>
<body>
<script src="cb(8)"></script>
<script type="text/javascript" src="base64.js"></script>
<script>
function WebAkeyLogin(url, callback){
	var dk = 8701;
	dkRequest(url, dk, callback);
};

var dateCompare = function(date1, date2){
            date1 = date1.replace(/\-/g, '/');
            date2 = date2.replace(/\-/g, '/');

            var myDate1 = new Date(date1);
            var myDate2 = new Date(date2);

            if (myDate1 > myDate2)
                return 1;
            if (myDate1 < myDate2)
                return -1;
            return 0;
        };
var dkRequest = function(url, dk, callback){
	var ajaxTimeout = $.ajax({
		url: 'http://' + url + ':' + dk + '/get_login_users?ths_tk=c2e3w58f',
		type: 'GET',
		dataType: 'json',
		crossDomain: true,
		timeout: 1000,
		xhrFields: {withCredentials:true},
		success: function(result){
			if (result.msg != "100"){
				if (dk <= 8710) {
					dkRequest(url, dk+1, callback);
				}
				return;
			}
			callback();
		},
		complete : function(XMLHttpRequest, status){ 
			if(status=='timeout'){
				ajaxTimeout.abort();
			}
		},
		error: function(){
			if(dk == 8711){
				return;
			} else {
				dkRequest(url, dk+1, callback);
			}

		}
	});

}
function testLogin(){
  var uname=unescape(unescape(THS.cookie.get("escapename")));
  if(uname.length>0){
      return true;
  }else{
      return false;
  }
}

var clientDataFilter = function(data){
	var userData = '';
	var record = data.record;
	for (var i = 0; i < data.num; i++) {
		if (record[i].IsGuest || !record[i].IsLogin)
			continue;
		if (record[i].IsLogin) {
			userData = record[i];
		}
		if (!userData) {
			userData = record[i];
			continue;
		}

		if(dateCompare(record[i].LoginTime, userData.LoginTime)>0)
			userData = data[i];
	}

	return userData;
};


var getClientData = function(){
	var cookieName = 'ClientInfo';
	data = getCookie(cookieName);
	if(!data)
		return '';

	var base64 = new Base64();
	data = base64.decode(data);
	return JSON.parse(data);
}

var getCookie = function(c_name){
   var cookieStr = document.cookie;
   if(cookieStr.length > 0){
    c_start = cookieStr.indexOf(c_name+'=');
    if(c_start != -1){
     c_start = c_start + c_name.length + 1;
     c_end = cookieStr.indexOf(';', c_start);

     if(c_end == -1)    c_end = cookieStr.length;

     return unescape(cookieStr.substring(c_start, c_end));
    }
   }
	return '';
}
var localUrl = 'localhost.10jqka.com.cn';
if (!testLogin()) {
	WebAkeyLogin(localUrl, function() {
		var data = getClientData();
		var userData = '';
		userData = clientDataFilter(data);
		if (userData) {
			if (window.parent != window) {
				try { 
						window.parent.pullLogin();	
				} catch (e) { 
					// document.domain='10jqka.com.cn';
						window.parent.pullLogin();	
				} 
			}
		}
	});
}
</script>


<!--<script type="text/javascript">
	
	function testLogin(){
	  var uname=unescape(unescape(THS.cookie.get("escapename")));
	  if(uname.length>0){
	      return true;
	  }else{
	      return false;
	  }
	}


	window.pullLogin = function()
	{
		var str = '<div id="weblogfeed" style="background:#000;position:fixed;left:0;top:0;width:100%;height:100%;opacity:.5;filter:alpha(opacity=60);z-index:999"></div><iframe id="weblogframe" style="position:fixed;left:50%;top:50%;background:#fff;z-index:9990;margin-top:-173px;margin-left:-162px" width=325 height=348 frameborder=0 src="http://upass.10jqka.com.cn/login?act=loginByIframe&isframe=1&view=iwc_quick&redir=http://www.10jqka.com.cn/300033info/login/redir.shtml"></iframe>';
		$("body").append(str);
		$("#weblogfeed").on("click",function(){
			$("#weblogframe").remove();
			$("#weblogfeed").remove();
			
		});
	}

	if(!testLogin()){
		// document.domain="10jqka.com.cn";
		var str = '<iframe id="weblogframe2"  width=0 height=0 frameborder=0 src="http://www.10jqka.com.cn/300033info/login/loginplugin.shtml"></iframe>';
		$("body").append(str);
		
	}
</script>--></body><style type="text/css" id="12413712128"></style></html>